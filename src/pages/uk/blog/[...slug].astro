---
// Astro Imports - Layout & Globals
import { Image } from 'astro:assets';
import BaseLayout from "@/layouts/BaseLayout.astro";
import { getCollection, type CollectionEntry } from 'astro:content';
import { getLangFromUrl, useTranslations } from "@/i18n/utils";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Separator } from "@/components/ui/separator";
import Blockquote from "@/components/typography/Blockquote.astro";
import H4 from "@/components/typography/H4.astro";
import H2 from "@/components/typography/H2.astro";
import SmallText from "@/components/typography/SmallText.astro";
import H1 from "@/components/typography/H1.astro";
import Prose from "@/components//typography/Prose.astro";
import Large from "@/components/typography/Large.astro";


// Utils Imports
import { formatDate, capitalizer } from "@/lib/utils";
import { getRelatedPosts } from "@/lib/fetchers";
import { ChevronLeft } from 'lucide-react'

// Function to create the path for all the blogs
export async function getStaticPaths() {
  const posts = await getCollection('blog', ({ id }) => {
    return id.startsWith('uk/')
  })
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: post,
  }))
}

// Props types
type Props = CollectionEntry<'blog'>

// Astro Props
const post = Astro.props
const { title, date, excerpt, author, categories, image } = post.data

// Astro Params
const slug = Astro.params.slug

// Special function to render the content of the MD
const { Content } = await post.render()

// Get realated Posts
const relatedPosts = await getRelatedPosts(categories[0], title)

// Redirect in case the path dosent exits
if (!slug || !post) {
  return new Response(null, {
    status: 404,
    statusText: 'Not found',
  })
}

// create static page instead of SSR
export const prerender = true
const lang = getLangFromUrl(Astro.url)
const t = useTranslations(lang)

---

<BaseLayout
  title={title}
  description={excerpt}
  ogImage={image}
  url={`${Astro.site}/${slug}`}
  post={post}
>
  <div class="container relative max-w-[1020px] px-5 py-10 pt-10">
    
    <a
      title="Повернутись до Блогу"
      href="/uk/blog"
      class="absolute left-[-150px] top-10 hidden text-bold items-center justify-center xl:flex hover:text-emerald-500 transition-all duration-200 hover:opacity-80 focus:opacity-80"
      transition:animate="slide"
    > 
    
      <ChevronLeft height="40px" />
    </a>  


    <!-- Category List -->
    
    <article
      class="max-w-none prose prose-a:text-emerald-500 dark:prose-headings:text-emerald-500 prose-heading:scroll-m-20 prose-heading:border-b prose-heading:pb-2 prose-heading:text-3xl prose-heading:font-semibold prose-heading:tracking-tight prose-heading:first:mt-0 prose-p:leading-7 prose-p:text-md prose-p:font-semibold prose-p:text-foreground dark:prose-strong:text-white dark:prose-ul:text-white/50"
    >
      <!-- Image -->
      <Image
        class="my-6 overflow-hidden rounded-xl"
        width={1020}
        height={510}
        src={image}
        alt={title}
        transition:name={'img-' + slug}
      />
      
      <!-- Date and Author -->
      <div class="flex items-center justify-between">
        <span
          class="font-medium text-muted-foreground"
          transition:name={'date-' + slug}
        >
        {formatDate(date)}
        </span>
        <span class="font-medium text-muted-foreground">
          {
            categories.map((category) => (
            <Badge variant="secondary"><a
                title={`Category - ${category}`}
                class="mx-auto hover:text-emerald-500 transition-all duration-200 hover:opacity-80 focus:opacity-80 text-sm font-medium leading-none"
                href={`/uk/categories/${category}`}
                aria-label={`Categorie-link-${category}`}
              >
                {capitalizer(category)}
              </a></Badge>
            
            ))
          }
        </span>
      </div>
      
      <!-- Title and description -->
      <h1 class="scroll-m-20 border-b pb-2 text-3xl font-semibold tracking-tight first:mt-0" transition:name={'title-' + slug}>
        {title}
      </h1>
      
      <Separator className="my-6" />
      <!-- Content -->
      <Content />
      <Separator className="my-6" />
      <!-- related posts -->
      <div
        class="flex flex-col items-center justify-between gap-5 md:flex-row md:gap-0"
      >
        {
          relatedPosts.slice(0, 2).map((item) => (
            <a
              title={`Link to ${item.data.title}`}
              class="text-secondary no-underline transition-colors duration-200 hover:text-secondary/70"
              href={`/en/blog/${item.slug}`}
              aria-label={`Related-link-${item.slug}`}
            >
              {item.data.title}
            </a>
          ))
        }
      </div>
    </article>
  </div>
<section class="mt-5" >

    <div class="px-4 mx-auto rounded-md bg-emerald-700 max-w-7xl sm:px-6 lg:px-8">
        <div class="2xl:pl-24">
            <div class="grid grid-cols-1 gap-y-12 md:grid-cols-2 md:gap-x-8 2xl:gap-x-20">
                <div class="text-center md:py-16 xl:py-24 md:text-left">
                    <Blockquote>
                        “Amet minim mollit non deserunt ullamco est sit aliqua dolor do amet sint. Velit officia consequat duis enim velit mollit. Exercitation veniam consequat sunt nostrud amet.”
                    </Blockquote>
                    <div class="mt-6 mx-auto sm:flex sm:items-baseline sm:justify-center md:justify-start">
                        <H4><Large>{author}</Large></H4>
                        <div class="mx-5"><SmallText>Project Manager at Microsoft</SmallText></div>
                    </div>
                    <H2>{excerpt}</H2>
                    <div class="mt-5">
                    <Button variant="outline">
                        <a class="hover:text-emerald-500 transition-all duration-200 hover:opacity-80 focus:opacity-80" href="/pricing "> Create your first website </a>
                        <svg class="w-5 h-5 ml-2 text-emerald-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                    </Button> 
                </div>
                </div>

                <div class="relative">
                    <img class="md:absolute md:bottom-0 md:scale-110 md:origin-bottom-right lg:scale-75 2xl:scale-100 2xl:-mt-20" src="https://cdn.rareblocks.xyz/collection/celebration/images/cta/11/smiling-man.png" alt="" />
                </div>
            </div>
        </div>
    </div>
</section>
</BaseLayout>